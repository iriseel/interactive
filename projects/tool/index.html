<!DOCTYPE html>
<html> 
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>capture and release</title>
    <link rel="icon" type="image/png" href="&#8779;"/>
 
      
    <link rel="stylesheet" href="style.css">
      
      
    </head>
    
  <body>
      
    <div class="bg_wrapper">
      <div class="bg"></div>
    </div>
      
      <div class="critter" data-index="0">
        <img src="img/palau/Jorunna_funebris.jpg" class="funebris">
    </div>
      
      
      <div class="critter" data-index="1">
        <img src="img/palau/fish.jpg" class="funebris">
    </div>
      
      <div class="info">
      If you want to capture another sea critter, you have to release the one you already got!
      </div>
      
      <div class="welcome">
        <p>
            Welcome to aquatic critters appreciation website! This is a place where sea lovers can upload their photos, and where viewers can experience the difficulties of visually capturing tiny, speedy ocean life that the photographers confronted when taking the photos!
        </p>
          <p>
              To view a photo, catch a critter.
          </p>
      </div>
      
      
      <div class="caption">
      tender
      </div>
      
      <div class="caption">
      violent
      </div>
      
      
      <div class="caption">
      symbiotic
      </div>
      
      <div class="caption">
      transience
      </div>
      
      <div class="caption">
      will the photos of these critters outlast their bodies?
      </div>
      
      
      
    
      
    <!--     displacement filter taken from https://www.youtube.com/watch?v=q-i0rZBZvBk
    It's cool but a lil too extra to use on entire sea bg :)

    <div class="displacement"></div>
      -->  
        <!-- 
            Make SVG top:0, otherwise it adds white space at bottom of document
        -->
        <svg style="position:absolute; z-index:-1; visibility:none; top:0;">
          <filter id="turbulence" x="0" y="0" width="100%" height="100%">
            <feTurbulence id="sea-filter" numOctaves="3" seed="2" baseFrequency="0.1 0.005"></feTurbulence>
            <feDisplacementMap scale="10" in="SourceGraphic"></feDisplacementMap>
            <animate xlink:href="#sea-filter" attributeName="baseFrequency" dur="30s" 
            keyTimes="0;0.5;1" values="0.02 0.06;0.04 0.08;0.02 0.06" repeatCount="indefinite"/>
          </filter>
        </svg>

      
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>

      
    <script type="text/javascript">
        
        
        //trying to randomize start positions of .critters
            
        var direction = "right",
            random_speed,

            //?? How do I make this var caught specific to EACH img? Right now if i click 1 image it changes the var globally
            caught = false;
        
        setTimeout(function() {
            $(".welcome").css({
                    visibility: "hidden",
                    opacity: "0"
                });
            }, 1000);
        

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        };
            
            
            //define function that assigns random starting Y
           function randomY() {
               var height = $(window).height();
    
                var randomY = getRandomInt(height, 0);
               
                $(this).css({
                    top: randomY
                });
           }; 
           
        //apply randomY function to each instance of .critter and .caption
        $(".critter").each(randomY);

         $(".caption").each(randomY);
            
        
            
        //randomize swimming and bouncing animations: using callback instead of setInterval to loop animations (because otherwise when I clearInterval on $("img").click, it would clear ALL the animations on other critters as well, not just the animation on the clicked critter)
           
        //Had to use data-index to randomize bounces and speeds, previously console.log was showing that the values were being randomized but the critters weren't actually
        
        var critters = $(".critter");
        var random_bounces_small = [],
            random_bounces_big = [],
            random_speeds = [],
            critters_length = critters.length;
        
        // create random bounce amounts, add to array
        for (let i = 0; i < critters.length; i++) {
            
            var random_bounce_big = Math.floor(Math.random() * 200 + 50);
            random_bounces_big.push(random_bounce_big);
            
            var random_bounce_small = Math.floor(Math.random() * 100 + 50);
            random_bounces_small.push(random_bounce_small);
            
            var random_speed = Math.floor(Math.random() * 200 + 100);
            
            random_speeds.push(random_speed);
        };
        
        
        
        function big_bounce(){

            var index = $(this).attr("data-index");
//            console.log("index =" + index);
            
            $(this).animate(
                {top:"+=" + random_bounces_big[index],
                    left:"+=" + random_speeds[index]}, 600);

            $(this).animate(
                {top:"-=" + random_bounces_big[index],
                left:"+=" + random_speeds[index]}, 600, small_bounce);
        };
            
            
        function small_bounce(){
            
            var index = $(this).attr("data-index");
//            console.log("index =" + index);

            $(this).animate({
                top: "+=" + random_bounces_small[index],
                left: "+=" + random_speeds[index]
            }, 600);

            $(this).animate({
                top: "-=" + random_bounces_small[index],
                left: "+=" + random_speeds[index]
            }, 600, big_bounce);

        };
               
              
            //??How do I add easing to this so it's not so 走走停停???
            $(".critter").each(big_bounce); 

//          $(".caption").each(big_bounce); 



        function big_bounce_reverse(){

            var index = $(this).attr("data-index");
//            console.log("index =" + index);
            
            $(this).animate(
                {top:"+=" + random_bounces_big[index],
                left:"-=" + random_speeds[index]}, 600);

            $(this).animate(
                {top:"-=" + random_bounces_big[index],
                left:"-=" + random_speeds[index]}, 600, small_bounce_reverse);
       };

        function small_bounce_reverse(){

            var index = $(this).attr("data-index");
//                console.log("index =" + index);

                $(this).animate({
                    top: "+=" + random_bounces_small[index],
                    left: "-=" + random_speeds[index]
                }, 600);

                $(this).animate({
                    top: "-=" + random_bounces_small[index],
                    left: "-=" + random_speeds[index]
                }, 600, big_bounce_reverse);
        };
               
        
        //??Why does the critter bounce back and forth at the boundary that triggers the reverse_bounce (i.e. at offset_left > 300 or width)
       function check_offset() {

            var offset = $(this).offset();
            var offset_left = offset.left;

            var width = $(".bg_wrapper").width();

            var index = $(this).attr("data-index");

//               console.log("offset is" + offset_left);
//               console.log("window width is" + width);

            if ((offset_left > 300) && (direction === "right")) {
                $(this).stop();

                //have to specify a starting animate, can't just do $(this).animate( {}, large_bounce_reverse — for whatever reason that makes everything just go up, no bounce down
                $(this).animate({
                    top: "+=" + random_bounces_small[index],
                    left: "-=" + random_speeds[index]
                }, 600);

                $(this).animate({
                    top: "-=" + random_bounces_small[index],
                    left: "-=" + random_speeds[index]
                }, 600, big_bounce_reverse);
                
                direction = "left";

            }

           else if ((offset_left < 0) && (direction === "left")) {

                $(this).animate({
                    top: "+=" + random_bounces_small[index],
                    left: "+=" + random_speeds[index]
                }, 600);

                $(this).animate({
                    top: "-=" + random_bounces_small[index],
                    left: "+=" + random_speeds[index]
                }, 600, big_bounce);
               
               direction = "right";

            };
           
          //??the directions don't seem to actually be changing??
           console.log(index + "direction is" + direction);
        };


        function checking_offset(){
            $(".critter").each(check_offset);
//            $(".caption").each(check_offset);

        };


      var checking_offset = setInterval(checking_offset, 1000);

        // resume bounce after mouseover
        function resume_animation(e) {
            var index = $(this).attr("data-index");
//            console.log("index =" + index);
            
            if (direction === "right") {
                e.animate({
                    top:"+=" + random_bounces_big[index],
                    left:"+=" + random_speeds[index]}, 600);

                e.animate({
                    top:"-=" + random_bounces_big[index],
                    left:"+=" + random_speeds[index]}, 600, small_bounce);

            } else if (direction === "left") {
                e.animate({
                    top:"+=" + random_bounces_big[index],
                    left:"-=" + random_speeds[index]}, 600);

                e.animate({
                    top:"-=" + random_bounces_big[index],
                    left:"-=" + random_speeds[index]}, 600, small_bounce_reverse);
            };
        }
        
    //?? There seems to be a delay between when console logs "escaping!" and when the critter moves, if at all
    //Make image escape cursor
      $(".critter").mouseenter(function() {
          
          console.log("escaping!");
          
          //MUST PUT if statement INSIDE a function for it to check for truth/false on each mouseover, rather than only on page load
          if (caught == false) { 
              
              // subtract image width and height from document dimensions if you don't wnat image to escape offscreen
              var wWidth = $(window).width(),
                  wHeight = $(window).height(),

              //dWidth/2 is maximum value, + 100 is minimum
                  nextX = Math.floor(Math.random() * (wWidth)) + 100,
                  nextY = Math.floor(Math.random() * (wHeight)) + 100;
              
                $(this).stop();

                $(this).animate({
                  left: nextX + "px",
                  top: nextY + "px"
                });
              
              var current_critter = $(this);

                setTimeout(function() {
                    console.log("resume");
                    resume_animation(current_critter);
                    
                }, 150);
           
            };
               
          });
          
        
        $("img").click(function() {
            
            //?? related to the var caught problem; i tried to make a second var to tie it to this ??
            var this_caught = true,
                currentX,
                currentY,
                offset;

            offset = $(this).offset();
            currentX = offset.left;
            currentY = offset.top;

//                console.log(currentX);
//                console.log(currentY);

            if (caught == false) {
                
                //stop animation on clicked .critter
                $(this).parent().stop();

                $(this).css({
                    width: "100%",
                    filter: "blur(0px)"
                });

                $(this).parent().css({
                    top: "0vh",
                    left: "0vw",
                    width: "100vw",
                    height: "100vh"
                });


                var caught_sfx = new Audio("sfx/victory.mp3");
                caught_sfx.play();

                caught = true;
                
            }
            
            else if ((caught == true) && (this_caught == true)) {
                
                $(this).css({
                    width: "100px",
                    filter: "blur(10px)"
                });

                $(this).parent().css({
                    top: currentY + "px",
                    left: currentX + "px",
                    width: "400px",
                    height: "400px"
                });
                     
                caught = false;
                
                }
            
            else {
                $(".info").css({
                    visibility: "visible",
                    opacity: "1"
                })
            };
            
                console.log("caught is" + caught);  
            });
        
                     
          
          
          
    </script>

  </body>
</html>
